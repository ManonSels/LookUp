{% extends "layout.html" %}

{% block title %}Manage Sections - {{ topic.title }}{% endblock %}

{% block content %}
<div id="topic-data" data-topic-id="{{ topic.id }}" style="display: none;"></div>

<div class="admin-header">
    <h1>Manage Sections: {{ topic.title }}</h1>
    <div>
        <a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
        <button id="add-section-btn" class="btn btn-primary">Add Section</button>
    </div>
</div>

<div class="sections-list" id="sections-list">
    {% for section in sections %}
    <div class="section-card" data-section-id="{{ section.id }}">
        <div class="section-header">
            <div class="section-handle">
                <span class="handle-icon">⋮⋮</span>
                <h3>{{ section.title }}</h3>
            </div>
            <div class="section-actions">
                <button class="btn btn-secondary add-item-btn" data-section-id="{{ section.id }}">Add Item</button>
                <button class="btn btn-secondary edit-section-btn" data-section-id="{{ section.id }}">Edit</button>
                <button class="btn btn-danger delete-section-btn" data-section-id="{{ section.id }}">Delete</button>
            </div>
        </div>

        <div class="items-list" id="items-list-{{ section.id }}" data-section-id="{{ section.id }}">
            {% if section.items %}
            {% for item in section.items %}
            <div class="item-card" data-item-id="{{ item.id }}">
                <div class="item-header">
                    <div class="item-handle">
                        <span class="handle-icon">⋮⋮</span>
                        <div class="item-title">
                            <h5>{{ item.title }}</h5>
                        </div>
                    </div>
                    <div class="item-actions">
                        <a href="{{ url_for('admin.edit_item', item_id=item.id) }}" class="btn btn-sm btn-secondary">Edit</a>
                        <a href="{{ url_for('admin.delete_item', item_id=item.id) }}" class="btn btn-sm btn-danger" onclick="return confirm('Delete this item?')">Delete</a>
                    </div>
                </div>
                <div class="item-preview">
                    {{ item.markdown_content[:200] }}{% if item.markdown_content|length > 200 %}...{% endif %}
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="empty-items" data-no-drag>
                <p>No items in this section yet. Drag items here or click "Add Item".</p>
            </div>
            {% endif %}
        </div>
    </div>
    {% else %}
    <div class="empty-state">
        <h2>No sections yet</h2>
        <p>Add your first section to start building this cheat sheet.</p>
    </div>
    {% endfor %}
</div>
{% endblock %}